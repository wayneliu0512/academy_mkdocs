
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.5">
    
    
      
        <title>Effective C++ - Allxon</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CPoppins&display=fallback">
        <style>:root{--md-text-font-family:"";--md-code-font-family:"Poppins"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="allxon" data-md-color-accent="light-blue">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#effective-c" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Allxon" class="md-header__button md-logo" aria-label="Allxon" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Allxon
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Effective C++
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="allxon" data-md-color-accent="light-blue" type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="allxon" data-md-color-accent="light-blue" type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/wayneliu0512/academy_mkdocs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wayneliu0512/academy_mkdocs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../agile_project_management/agile_development/" class="md-tabs__link">
        Agile Development
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../variables_types/" class="md-tabs__link md-tabs__link--active">
        C++
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../git/getting_started/" class="md-tabs__link">
        Git
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../ood/solid/" class="md-tabs__link">
        Object Oriented Programming
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../design_pattern/strategy/" class="md-tabs__link">
        Others
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Allxon" class="md-nav__button md-logo" aria-label="Allxon" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    Allxon
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/wayneliu0512/academy_mkdocs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wayneliu0512/academy_mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Agile Development
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Agile Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Agile Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../agile_project_management/agile_development/" class="md-nav__link">
        Agile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../agile_project_management/jira_project_management/" class="md-nav__link">
        Jira
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../agile_project_management/kanban/" class="md-nav__link">
        Kanban
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../agile_project_management/scrum/" class="md-nav__link">
        Scrum
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../agile_project_management/software_development/" class="md-nav__link">
        Software Development
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        C++
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="C++" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          C++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../variables_types/" class="md-nav__link">
        Variables and Types
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../compound_type/" class="md-nav__link">
        Compound Type
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class/" class="md-nav__link">
        Class
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../copy_control/" class="md-nav__link">
        Copy Control
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../object_oriented_programming/" class="md-nav__link">
        Object Oriented Programming
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../smart_pointer/" class="md-nav__link">
        Smart Pointer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../template/" class="md-nav__link">
        Template
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../exception/" class="md-nav__link">
        Exception
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Effective C++
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Effective C++
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-view-c-as-a-federation-of-languages" class="md-nav__link">
    1. View C++ as a federation of languages.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-prefer-const-enum-and-inline-to-define" class="md-nav__link">
    2. Prefer const , enum , and inline to #define .
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-use-const-whenever-possible" class="md-nav__link">
    3. Use const whenever possible.
  </a>
  
    <nav class="md-nav" aria-label="3. Use const whenever possible.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#const-member-functions" class="md-nav__link">
    const Member Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoiding-duplication-in-const-and-non-const-member-functions" class="md-nav__link">
    Avoiding Duplication in const and Non-const Member Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-make-sure-that-objects-are-initialized-before-theyre-used" class="md-nav__link">
    4. Make sure that objects are initialized before they're used.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-know-what-function-c-silently-writes-and-calls" class="md-nav__link">
    5. Know what function C++ silently writes and calls.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-explicitly-disallow-the-use-of-compiler-generated-functions-you-do-not-want" class="md-nav__link">
    6. Explicitly disallow the use of compiler-generated functions you do not want.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-declare-destructors-virtual-in-polymorphic-base-classes" class="md-nav__link">
    7. Declare destructors virtual in polymorphic base classes.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-prevent-exceptions-from-leaving-destructors" class="md-nav__link">
    8. Prevent exceptions from leaving destructors.
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cpp11_feature/" class="md-nav__link">
        C++ 11 Feature
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Git
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Git" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Git
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/getting_started/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/clone_recording_changes/" class="md-nav__link">
        Basic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/branching_nutshell/" class="md-nav__link">
        Branching
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/branching_merging/" class="md-nav__link">
        Branching and Merging
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/branch_mang_remote/" class="md-nav__link">
        Branch Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/remote/" class="md-nav__link">
        Remote Branches
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../git/rebasing/" class="md-nav__link">
        Rebasing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Object Oriented Programming
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Object Oriented Programming" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Object Oriented Programming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ood/solid/" class="md-nav__link">
        SOLID
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ood/coupling_packages/" class="md-nav__link">
        Package Coupling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ood/package_cohesion/" class="md-nav__link">
        Package Cohesion
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Others
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Others" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Others
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      <label class="md-nav__link" for="__nav_6_1">
        Design Pattern
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Design Pattern" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Design Pattern
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../design_pattern/strategy/" class="md-nav__link">
        Strategy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../design_pattern/command/" class="md-nav__link">
        Command
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../design_pattern/factory/" class="md-nav__link">
        Factory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../design_pattern/decorator/" class="md-nav__link">
        Decorator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../design_pattern/observer/" class="md-nav__link">
        Observer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../design_pattern/singleton/" class="md-nav__link">
        Singleton
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      <label class="md-nav__link" for="__nav_6_2">
        Qt
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Qt" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Qt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../qt/model_view/" class="md-nav__link">
        Model View
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../qt/qt_threading_event/" class="md-nav__link">
        Threading and Event
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ros/ros/" class="md-nav__link">
        ROS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../concurrency/concurrency/" class="md-nav__link">
        Concurrency
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../google_mock/" class="md-nav__link">
        Google Mock
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-view-c-as-a-federation-of-languages" class="md-nav__link">
    1. View C++ as a federation of languages.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-prefer-const-enum-and-inline-to-define" class="md-nav__link">
    2. Prefer const , enum , and inline to #define .
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-use-const-whenever-possible" class="md-nav__link">
    3. Use const whenever possible.
  </a>
  
    <nav class="md-nav" aria-label="3. Use const whenever possible.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#const-member-functions" class="md-nav__link">
    const Member Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoiding-duplication-in-const-and-non-const-member-functions" class="md-nav__link">
    Avoiding Duplication in const and Non-const Member Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-make-sure-that-objects-are-initialized-before-theyre-used" class="md-nav__link">
    4. Make sure that objects are initialized before they're used.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-know-what-function-c-silently-writes-and-calls" class="md-nav__link">
    5. Know what function C++ silently writes and calls.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-explicitly-disallow-the-use-of-compiler-generated-functions-you-do-not-want" class="md-nav__link">
    6. Explicitly disallow the use of compiler-generated functions you do not want.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-declare-destructors-virtual-in-polymorphic-base-classes" class="md-nav__link">
    7. Declare destructors virtual in polymorphic base classes.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-prevent-exceptions-from-leaving-destructors" class="md-nav__link">
    8. Prevent exceptions from leaving destructors.
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/wayneliu0512/academy_mkdocs/edit/master/docs/c++/effective_cpp.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="effective-c">Effective C++</h1>
<h2 id="1-view-c-as-a-federation-of-languages">1. View C++ as a federation of languages.</h2>
<p>In the beginning, C++ was just C with some object-oriented features tacked on. Even C++'s original name, "C with Classes", reflected this simple heritage.</p>
<p>As the language matured, it grew bolder and more adventurous. Today C++ is a <em>multiparadigm programming language</em>, one supporting a combination of procedural, object-oriented, functional, generic, and metaprogramming features. This is power and flexibility make C++ a tool without equal, but can also cause some confusion.</p>
<p>The easiest way is to view C++ not as a single language but as a federation of related languages. To make sense of C++, you have to recognize its primary sub-languages.</p>
<ul>
<li>
<p><strong>C</strong></p>
<p>Blocks, statements, the preprocessor, build-in data types, arrays, pointers, etc...</p>
</li>
<li>
<p><strong>Object-Oriented C++</strong></p>
<p>Classes, encapsulation, inheritance, polymorphism, virtual functions, etc...</p>
</li>
<li>
<p><strong>Template C++</strong></p>
<p>This is the generic programming part of C++.</p>
</li>
<li>
<p><strong>The STL</strong></p>
<p>The STL is a template library. Its conventions regarding containers, iterators, algorithm, and function objects, etc...</p>
</li>
</ul>
<p><strong>Things to Remember</strong></p>
<ul>
<li>Rules for effective C++ programming vary, depending on the part of C++ you are using.</li>
</ul>
<h2 id="2-prefer-const-enum-and-inline-to-define">2. Prefer <code>const</code> , <code>enum</code> , and <code>inline</code> to <code>#define</code> .</h2>
<p>This item might better be called "prefer the compiler to the preprocessor", because <code>#define</code> may be treated as if it's not part of the language. For example:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>#define ASPECT_RATIO 1.653
</code></pre></div>
<p>The symbolic name <code>ASPECT_RATIO</code> may never be seen by compiler; This can be confusing if you get an error during compilation involving the use of the constant, because the error message may refer to <code>1.653</code>, not <code>ASPECT_RATIO</code> .</p>
<p>The solution is to replace the macro with a constant:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>const double kAspectRatio = 1.653;
</code></pre></div>
<p>The second special case concerns class-specific constants. To limit the scope of a constant to a class, you must make it a member, and to ensure there's at most one copy of the constant, you must make it a <code>static</code> member:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">CostEstimate</span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">FudgeFactor</span><span class="p">;</span> <span class="c1">// declaration; goes in header file</span>
<span class="linenos" data-linenos="4 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="5 "></span><span class="p">};</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="k">const</span> <span class="kt">double</span> <span class="n">CostEstimate</span><span class="o">::</span><span class="n">FudgeFactor</span> <span class="o">=</span> <span class="mf">1.35</span><span class="p">;</span> <span class="c1">//definition; goes in impl. file</span>
</code></pre></div>
<p>There is a exception when you need the value of a class constant during compilation of the class, you can use <code>enum</code> defined like this:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">GamePlayer</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">enum</span> <span class="p">{</span><span class="n">NumTurns</span> <span class="o">=</span> <span class="mi">5</span><span class="p">};</span> <span class="c1">// enum class is better.</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span>    <span class="kt">int</span> <span class="n">scores</span><span class="p">[</span><span class="n">NumTurns</span><span class="p">];</span>
<span class="linenos" data-linenos="6 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="7 "></span><span class="p">};</span>
</code></pre></div>
<p>Getting back to preprocessor, another common (mis)use of the <code>#define</code> directive is using it to implement macros that look like functions but that don't incur the overhead of a function call.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#define CALL_WITH_MAX(a, b) f((a) &gt; (b) ? (a) : (b))</span>
</code></pre></div>
<p>Look at the weird things that can happen:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">CALL_WITH_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>    <span class="c1">// a is incremented twice</span>
<span class="linenos" data-linenos="3 "></span><span class="n">CALL_WITH_MAX</span><span class="p">(</span><span class="o">++</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// a is incremented once</span>
</code></pre></div>
<p>The solution is:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>   <span class="c1">// template &lt;class T&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="kr">inline</span> <span class="kt">void</span> <span class="n">CallWithMax</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="n">f</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<p><strong>Things to Remember</strong></p>
<ul>
<li>For simple constants, prefer <code>const</code> objects or <code>enum</code> to <code>#define</code>.</li>
<li>For function-like macros, prefer inline functions to <code>#define</code>.</li>
</ul>
<h2 id="3-use-const-whenever-possible">3. Use <code>const</code> whenever possible.</h2>
<p>The wonderful thing about <code>const</code> is that it allows you to specify a semantic constraint - a particular object should not be modified - and compilers will enforce that constraint.</p>
<p>這個章節希望大家每當有可能就使用 <code>const</code>, 所以前半部很多內容是在複習 <code>const</code> 的作用, 這部分我就只用 sample code 帶過, 大家也順便複習一下, 看是不是知道這些 <code>const</code> 的用法以及差異, 如果有不懂的地方可以提出來.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">char</span> <span class="n">greeting</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">;</span>              <span class="c1">// non-const pointer,</span>
<span class="linenos" data-linenos="3 "></span>                                 <span class="c1">// non-const data</span>
<span class="linenos" data-linenos="4 "></span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">;</span>        <span class="c1">// non-const pointer,</span>
<span class="linenos" data-linenos="5 "></span>                                 <span class="c1">// const data</span>
<span class="linenos" data-linenos="6 "></span><span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">p</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">;</span>       <span class="c1">// const pointer,</span>
<span class="linenos" data-linenos="7 "></span>                                 <span class="c1">// non-const data</span>
<span class="linenos" data-linenos="8 "></span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">p</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">;</span> <span class="c1">// const pointer, </span>
<span class="linenos" data-linenos="9 "></span>                                 <span class="c1">// const data</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">void</span> <span class="nf">f1</span><span class="p">(</span><span class="k">const</span> <span class="n">Widget</span> <span class="o">*</span><span class="n">pw</span><span class="p">);</span> <span class="c1">// f1 takes a pointer to a constant Widget object</span>
<span class="linenos" data-linenos="2 "></span><span class="kt">void</span> <span class="nf">f2</span><span class="p">(</span><span class="n">Widget</span> <span class="k">const</span> <span class="o">*</span><span class="n">pw</span><span class="p">);</span> <span class="c1">// so does f2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="p">...</span>
<span class="linenos" data-linenos="3 "></span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="c1">// iter acts like a T* const</span>
<span class="linenos" data-linenos="4 "></span><span class="o">*</span><span class="n">iter</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>                                          <span class="c1">// OK, changes what iter points to</span>
<span class="linenos" data-linenos="5 "></span><span class="o">++</span><span class="n">iter</span><span class="p">;</span>                                              <span class="c1">// error! iter is const</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">c_iter</span> <span class="o">=</span> <span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="c1">// c_iter acts like a const T*</span>
<span class="linenos" data-linenos="8 "></span><span class="o">*</span><span class="n">c_iter</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>                                          <span class="c1">// error! *c_iter is const</span>
<span class="linenos" data-linenos="9 "></span><span class="o">++</span><span class="n">c_iter</span><span class="p">;</span>                                              <span class="c1">// fine, changes c_iter</span>
</code></pre></div>
<h3 id="const-member-functions"><code>const</code> Member Functions</h3>
<p>The purpose of <code>const</code> on member functions is to identify which member functions may be invoked on <code>const</code> objects. Such member functions are important for two reasons. First, they make the interface of a class easier to understand. It's important to know which functions may modify an object and which may not. Seconds, they make it possible to work with <code>const</code> objects. That's a critical aspect of writing efficient code, because, as Item 20 explains, one of the fundamental ways to improve a C++ program's performance is to pass objects by reference-to-const.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">TextBlock</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">const</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">position</span><span class="p">)</span> <span class="k">const</span> <span class="c1">// operator[] for</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span> <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">position</span><span class="p">];</span> <span class="p">}</span>                               <span class="c1">// const objects</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">position</span><span class="p">)</span>             <span class="c1">// operator[] for</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">{</span> <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">position</span><span class="p">];</span> <span class="p">}</span>                               <span class="c1">// non-const objects</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="10 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">};</span>
</code></pre></div>
<p><code>TextBlock</code> 's <code>operator[]</code> s can be used like this:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">TextBlock</span> <span class="nf">tb</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>           <span class="c1">// calls non-const TextBlock::operator[]</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">const</span> <span class="n">TextBlock</span> <span class="nf">ctb</span><span class="p">(</span><span class="s">&quot;World&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ctb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>          <span class="c1">// calls const TextBlock::operator[]</span>
</code></pre></div>
<p>Incidentally, <code>const</code> objects most often arise in real programs as a result of being passed by pointer- or reference-to-const.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">const</span> <span class="n">TextBlock</span><span class="o">&amp;</span> <span class="n">ctb</span><span class="p">)</span>  <span class="c1">// in this function, ctb is const</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ctb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>            <span class="c1">// call const TextBlock::operator[]</span>
<span class="linenos" data-linenos="4 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<p>By overloading <code>operator[]</code> and giving the different versions different return types, you can have <code>const</code> and non- <code>const</code> <code>TextBlock</code> s handled differently:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  <span class="c1">// fine - reading a non-const TextBlock</span>
<span class="linenos" data-linenos="2 "></span><span class="n">tb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;x&#39;</span><span class="p">;</span>         <span class="c1">// fine - writing a non-const TextBlock</span>
<span class="linenos" data-linenos="3 "></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ctb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// fine - reading a const TextBlock</span>
<span class="linenos" data-linenos="4 "></span><span class="n">ctb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;x&#39;</span><span class="p">;</span>        <span class="c1">// error! - writing a const TextBlock</span>
</code></pre></div>
<p>Sometimes <code>const</code> member function might modify some of the bits in the object on which it's invoked, but only in ways that clients cannot detect. For example, your <code>CTextBlock</code> class might want to cache the length of the textbook whenever it's requested:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">CTextBlock</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">length</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="kt">char</span> <span class="o">*</span><span class="n">pText</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">textLength</span><span class="p">;</span>  <span class="c1">// last calculated length of textblock</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="kt">bool</span> <span class="n">lengthIsValid</span><span class="p">;</span>      <span class="c1">// whether length is currently valid</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">CTextBlock</span><span class="o">::</span><span class="n">length</span><span class="p">()</span> <span class="k">const</span>
<span class="linenos" data-linenos="13 "></span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lengthIsValid</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="n">textLength</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">strlen</span><span class="p">(</span><span class="n">pText</span><span class="p">);</span> <span class="c1">// error! can&#39;t assign to textLength and lengthIsValid in a const member function</span>
<span class="linenos" data-linenos="16 "></span>        <span class="n">lengthIsValid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">return</span> <span class="n">textLength</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
</code></pre></div>
<p>This implementation of <code>length</code> is certainly not bitwise <code>const</code> - both <code>textLength</code> and <code>lengthIsValid</code> may be modified. Compilers disagree. They insist on bitwise constness. What to do?</p>
<p>The solution is simple: take advantage of C++'s <code>const</code>-related wiggle room known as <code>mutable</code>. <code>mutable</code> frees non-static data members from the constraints of bitwise constness:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">CTextBlock</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">length</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="kt">char</span> <span class="o">*</span><span class="n">pText</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">mutable</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">textLength</span><span class="p">;</span>  <span class="c1">// these data members may</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">mutable</span> <span class="kt">bool</span> <span class="n">lengthIsValid</span><span class="p">;</span>      <span class="c1">// always be modified, even</span>
<span class="linenos" data-linenos="10 "></span>                                     <span class="c1">// in const member function</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="avoiding-duplication-in-const-and-non-const-member-functions">Avoiding Duplication in <code>const</code> and Non-<code>const</code> Member Functions</h3>
<p>For example, suppose that <code>operator[]</code> in <code>TextBlock</code> not only returned a reference to the appropriate character, it also performed bounds checking, logged access information, maybe even did data integrity validation. Putting all this in both the <code>const</code> and the non-<code>const</code> <code>operator[]</code> functions yields this kind of monstrosity:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">TextBlock</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">const</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">position</span><span class="p">)</span> <span class="k">const</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="p">...</span> <span class="c1">// do bounds checking</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="p">...</span> <span class="c1">// log access data</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="p">...</span> <span class="c1">// verify data integrity</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">position</span><span class="p">];</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">position</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">...</span> <span class="c1">// do bounds checking</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">...</span> <span class="c1">// log access data</span>
<span class="linenos" data-linenos="16 "></span>        <span class="p">...</span> <span class="c1">// verify data integrity</span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">position</span><span class="p">];</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="21 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span><span class="p">};</span>
</code></pre></div>
<p>Ouch! Can you say code duplication, along with its attendant compilation time, maintenance, and code-bloat headaches? Sure, So what you really want to do is implement <code>operator[]</code> functionality once and use it twice. That is, you want to have one version of <code>operator[]</code> call the other one. And that bring us to casting away constness.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">TextBlock</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">const</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">position</span><span class="p">)</span> <span class="k">const</span> <span class="c1">// same as before</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="p">...</span> 
<span class="linenos" data-linenos=" 7 "></span>        <span class="p">...</span> 
<span class="linenos" data-linenos=" 8 "></span>        <span class="p">...</span> 
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">position</span><span class="p">];</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">position</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">return</span> 
<span class="linenos" data-linenos="15 "></span>          <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&amp;&gt;</span><span class="p">(</span>                     <span class="c1">// cast away const on op[]&#39;s return type;</span>
<span class="linenos" data-linenos="16 "></span>            <span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">TextBlock</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span> <span class="c1">// add const to *this&#39;s type;</span>
<span class="linenos" data-linenos="17 "></span>              <span class="p">[</span><span class="n">position</span><span class="p">]</span>                         <span class="c1">// call const version of op[]</span>
<span class="linenos" data-linenos="18 "></span>        <span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="23 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span><span class="p">};</span>
</code></pre></div>
<p><strong>Things to Remember</strong></p>
<ul>
<li>Declaring something <code>const</code> helps compilers detect usage errors. <code>const</code> can be applied to objects at any scope, to function parameters and return types, and to member functions as a whole.</li>
<li>Compilers enforce bitwise constness, but you should program using logical constness.</li>
<li>When <code>const</code> and non-<code>const</code> member functions have essentially identical implementations, code duplication can be avoided by having the non-<code>const</code> version call the <code>const</code> version.  </li>
</ul>
<h2 id="4-make-sure-that-objects-are-initialized-before-theyre-used">4. Make sure that objects are initialized before they're used.</h2>
<p>C++ can seem rather fickle about initializing the values of objects. For example, if you say this,</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</code></pre></div>
<p>in some constexts, <code>x</code> is guaranteed to be initialized(to zero), but in others, it's not. If you say this,</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="linenos" data-linenos="3 "></span><span class="p">}</span>
<span class="linenos" data-linenos="4 "></span><span class="p">...</span>
<span class="linenos" data-linenos="5 "></span><span class="n">Point</span> <span class="n">p</span><span class="p">;</span>
</code></pre></div>
<p><code>p</code>'s data members are sometimes guaranteed to be initialized(to zero), but sometimes they're not. Reading uninitialized values yields undefined behavior.</p>
<p>Now, there are rules that describe when object initialization is guaranteed to take place and when it isn't. Unfortunately, the rules are complicated - too complicated to be memorizing.</p>
<p>The best way to deal with this seemingly indeterminate state of affairs is to <em>always</em> initialize your objects before you use them.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                             <span class="c1">// manual initialization of an int</span>
<span class="linenos" data-linenos="2 "></span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;A C-style string&quot;</span><span class="p">;</span> <span class="c1">// manual initialization of a pointer</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="kt">double</span> <span class="n">d</span><span class="p">;</span>                              <span class="c1">// &quot;initialization&quot; by </span>
<span class="linenos" data-linenos="5 "></span><span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">d</span><span class="p">;</span>                         <span class="c1">// reading from an input stream</span>
</code></pre></div>
<p>For almost everything else, the responsibility for initialization falls on constructors. The rule there is simple: make sure that all constructors initialize everything in the object.</p>
<p>The rule is easy to follow, but it's important not to confuse assignment with initialization.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">PhoneNumber</span> <span class="p">{...};</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">class</span> <span class="nc">ABEntry</span><span class="p">{</span>   <span class="c1">// ABEntry = &quot;Address Book Entry&quot;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">ABEntry</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">address</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span>            <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;&amp;</span> <span class="n">phone</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">theName</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">theAddress</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;</span> <span class="n">thePhones</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="kt">int</span> <span class="n">numTimesConsulted</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span><span class="p">};</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="n">ABEntry</span><span class="o">::</span><span class="n">ABEntry</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">address</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span>                 <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;&amp;</span> <span class="n">phone</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span><span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>    <span class="n">theName</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>        <span class="c1">// these are all assignments,</span>
<span class="linenos" data-linenos="19 "></span>    <span class="n">theAddress</span> <span class="o">=</span> <span class="n">address</span><span class="p">;</span>  <span class="c1">// not initializations</span>
<span class="linenos" data-linenos="20 "></span>    <span class="n">thePhones</span> <span class="o">=</span> <span class="n">phones</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>    <span class="n">numTimesConsulted</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span><span class="p">}</span>
</code></pre></div>
<p>This will yield <code>ABEntry</code> objects with the values you expect, but it's still not the best approach. They aren't being initialized, they're being assigned. Initialization took place earlier.</p>
<p>A better way to write the <code>ABEntry</code> constructor is to use the member initialization list instead of assignments:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">ABEntry</span><span class="o">::</span><span class="n">ABEntry</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">address</span><span class="p">,</span>
<span class="linenos" data-linenos="2 "></span>                 <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;&amp;</span> <span class="n">phone</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="o">:</span> <span class="n">theName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
<span class="linenos" data-linenos="4 "></span>  <span class="n">theAddress</span><span class="p">(</span><span class="n">address</span><span class="p">),</span>   <span class="c1">// these are now all initializations</span>
<span class="linenos" data-linenos="5 "></span>  <span class="n">thePhones</span><span class="p">(</span><span class="n">phones</span><span class="p">),</span>
<span class="linenos" data-linenos="6 "></span>  <span class="n">numTimesConsulted</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos" data-linenos="7 "></span><span class="p">{}</span>
</code></pre></div>
<p>Sometimes the initialization list must be used, even for built-in types. For example, data member that are <code>const</code> or are references must be initialized. They cant't be assigned.</p>
<p>One aspect of C++ that isn't fickle is the order in which an object's data is initialized. This order is always the same: base classes are initialized before derived classes, and within a class, data members are initialized in the order in which they are declared. This is true even if they are listed in a different order on the member initialization list. To avoid reader confusion, always list members in the initialization list in the same order as they're declared in the class.</p>
<p><strong>Things to Remember</strong></p>
<ul>
<li>Manually initialize objects of built-in type, because C++ only sometimes initializes them itself.</li>
<li>In a constructor, prefer use of the member initialization list to assignment inside the body of the constructor. List data members in the initialization list in the same order ther're declared in the class.</li>
<li>Avoid initialization order problem across translation units by replacing non-local statics objects with local static objects.</li>
</ul>
<h2 id="5-know-what-function-c-silently-writes-and-calls">5. Know what function C++ silently writes and calls.</h2>
<p>When is an empty class not an empty class? When C++ gets through with it. If you don't declare them yourself, compiler will declare their own versions of a copy constructor, a copy assignment operator, and a destructor. As a result, if you write </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Empty</span><span class="p">{};</span>
</code></pre></div>
<p>it's essentially the same as if you'd written this:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Empty</span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="3 "></span>    <span class="n">Empty</span><span class="p">(){...}</span>                  <span class="c1">// default constructor</span>
<span class="linenos" data-linenos="4 "></span>    <span class="n">Empty</span><span class="p">(</span><span class="k">const</span> <span class="n">Empty</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){...}</span>  <span class="c1">// copy constructor</span>
<span class="linenos" data-linenos="5 "></span>    <span class="o">~</span><span class="n">Empty</span><span class="p">(){...}</span>                 <span class="c1">// destructor</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span>    <span class="n">Empty</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Empty</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">){...}</span> <span class="c1">// copy assignment operator</span>
<span class="linenos" data-linenos="8 "></span><span class="p">};</span>
</code></pre></div>
<p>These functions are generated only if they are needed. The following code will cause each function to be generated:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Empty</span> <span class="n">e1</span><span class="p">;</span>     <span class="c1">// default constructor</span>
<span class="linenos" data-linenos="2 "></span>              <span class="c1">// destructor</span>
<span class="linenos" data-linenos="3 "></span><span class="n">Empty</span> <span class="nf">e2</span><span class="p">(</span><span class="n">e1</span><span class="p">);</span> <span class="c1">// copy constructor</span>
<span class="linenos" data-linenos="4 "></span><span class="n">e2</span> <span class="o">=</span> <span class="n">e1</span><span class="p">;</span>      <span class="c1">// copy assignment operator</span>
</code></pre></div>
<p>Let's consider next example:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">NamedObject</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="n">NamedObject</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">NamedObject</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">nameValue</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="n">T</span> <span class="n">objectValue</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<p>Because a constructor is declared in <code>NamedObject</code>, compilers won't generate a default constructor. This is important.</p>
<p><code>NamedObject</code> declares neither copy constructor nor copy assignment operator. so compilers will generate those functions. Look, then, at this use of the copy constructor:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">NamedObject</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">no1</span><span class="p">(</span><span class="s">&quot;Small prime number&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="n">NamedObject</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">no2</span><span class="p">(</span><span class="n">no1</span><span class="p">);</span>  <span class="c1">// calls copy constructor</span>
</code></pre></div>
<p>The copy constructor generated by compilers must initialize <code>no2.nameValue</code> and <code>no2.objectValue</code> using <code>no1.nameValue</code> and <code>no1.objectValue</code>, respectively. The type of <code>nameValue</code> is <code>string</code>, so <code>no2.nameValue</code> will be initialized by calling the <code>string</code> copy constructor with <code>no1.nameValue</code> as its argument. On the other hand, <code>int</code> is a built-in type, so <code>no2.objectValue</code> will be initialized by copying the bits in <code>no1.objectValue</code>.</p>
<p>The compiler-generated copy assignment operator for <code>NameObject&lt;int&gt;</code> would behave essentially the same way.</p>
<p>Next example, suppose <code>NameObject</code> were defined like this, where <code>nameValue</code> is a reference to a string and <code>objectValue</code> is a <code>const T</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">NamedObject</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="n">NamedObject</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">nameValue</span><span class="p">;</span> <span class="c1">// this is now a reference</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">const</span> <span class="n">T</span> <span class="n">objectValue</span><span class="p">;</span>    <span class="c1">// this is now const</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
<p>Now consider what should happen here:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">newDog</span><span class="p">(</span><span class="s">&quot;Persephone&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">oldDog</span><span class="p">(</span><span class="s">&quot;Satch&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="n">NameObject</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span> <span class="p">(</span><span class="n">newDog</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="n">NameObject</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">s</span> <span class="p">(</span><span class="n">oldDog</span><span class="p">,</span> <span class="mi">36</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span>
<span class="linenos" data-linenos="8 "></span><span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>  <span class="c1">// what should happen to the data members in p ?</span>
</code></pre></div>
<p>After the assignment, should <code>p.nameValue</code> refer to the <code>string</code> referred to by <code>s.nameValue</code>. Should the reference itself be modified? If so, that breaks new ground, because C++ doesn't provide a way to make a reference refer to a different object.</p>
<p>Faced with this conundrum, C++ refuse to compile the code. If you want to support copy assignment in a class containing a reference member, you must define the copy assignment operator yourself. Compilers behave similarly for classes containing <code>const</code> members.</p>
<p><strong>Things to Remember</strong></p>
<ul>
<li>Compilers may implicitly generate a class's default constructor, copy constructor, copy assignment operator, and destructor.</li>
</ul>
<h2 id="6-explicitly-disallow-the-use-of-compiler-generated-functions-you-do-not-want">6. Explicitly disallow the use of compiler-generated functions you do not want.</h2>
<p>這邊書是以房產做舉例, 假設我們把房產寫成一個類:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">HomeForSale</span><span class="p">{...};</span>
</code></pre></div>
<p>我們可以知道現實中任何一個房產都是獨一無二的, 如果它可以複製, 那肯定是不合理的, 所以對於以下情況, 我們應該讓它編譯失敗:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">HomeForSale</span> <span class="n">h1</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">HomeForSale</span> <span class="n">h2</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="n">HomeForSale</span> <span class="nf">h3</span><span class="p">(</span><span class="n">h1</span><span class="p">);</span>  <span class="c1">// attempt to copy h1 - should not compile!</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="n">h1</span> <span class="o">=</span> <span class="n">h2</span>              <span class="c1">// attempt to copy h2 - should not compile!</span>
</code></pre></div>
<p>然而要作到這樣的效果並不直觀, 通常我們直覺會認為如果我們不想要一個 function 的功能, 我們只要不宣告這個 function 就好了, 但這個作法在 copy constructor, copy assignment operator 不管用, 因為根據第 5 點我們提到, 如果你不宣告, compiler 會幫你自動宣告.</p>
<p>所以如果我們要解決這個問題, 可以用以下方法:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">HomeForSale</span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="4 "></span>    <span class="n">HomeForSale</span><span class="p">(</span><span class="k">const</span> <span class="n">HomeForSale</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="n">HomeForSale</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HomeForSale</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">};</span>
</code></pre></div>
<p><strong>Things to Remember</strong></p>
<ul>
<li>To disallow functionality automatically provided by compilers, declare the corresponding member functions <code>= delete</code> and give no implementations.</li>
</ul>
<h2 id="7-declare-destructors-virtual-in-polymorphic-base-classes">7. Declare destructors virtual in polymorphic base classes.</h2>
<p>There are lots of ways to keep track of time, so it would be resonable to create a <code>TimeKeeper</code> base class along with derived classes for different approaches to timekeeping:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">TimeKeeper</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="n">TimeKeeper</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="o">~</span><span class="n">TimeKeeper</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">class</span> <span class="nc">AtomicClock</span><span class="o">:</span> <span class="k">public</span> <span class="n">TimeKeeper</span> <span class="p">{...};</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">class</span> <span class="nc">WaterClock</span><span class="o">:</span> <span class="k">public</span> <span class="n">TimeKeeper</span> <span class="p">{...};</span>
<span class="linenos" data-linenos="10 "></span><span class="k">class</span> <span class="nc">WristWatch</span><span class="o">:</span> <span class="k">public</span> <span class="n">TimeKeeper</span> <span class="p">{...};</span>
</code></pre></div>
<p>Many clients will want access to the time without worrying about the details of how it's calculated, so a factory function - a function that return a base class pointer to a newly-created derived class object - can be used to return a pointer to a timekeeping object:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">TimeKeeper</span> <span class="o">*</span><span class="nf">getTimeKeeper</span><span class="p">();</span> <span class="c1">// returns a pointer to a dynamically allocated object of a class derived from TimeKeeper</span>
</code></pre></div>
<p>Consider next situation:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">TimeKeeper</span> <span class="o">*</span><span class="n">ptk</span> <span class="o">=</span> <span class="n">getTimeKeeper</span><span class="p">();</span> <span class="c1">// get dynamically allocated object from TimeKeeper hierachy</span>
<span class="linenos" data-linenos="2 "></span><span class="p">...</span>                                <span class="c1">// use it</span>
<span class="linenos" data-linenos="3 "></span><span class="k">delete</span> <span class="n">ptk</span><span class="p">;</span>                        <span class="c1">// release it to avoid resource leak</span>
</code></pre></div>
<p>The problem is that <code>getTimeKeeper</code> returns a pointer to a derived class object(e.g. <code>AtomClock</code>), that object is being deleted via a base class pointer(i.e., a <code>TimeKeeper*</code> pointer), and the base class (<code>TimeKeeper</code>) has a non-virtual destructor. This is a recipe for disaster, result are undefined. What typically  happens at runtime is that the derived part of the object is never destroyed.</p>
<p>Eliminating the problem is simple: give the base class a virtual destructor. Then deleting the derived class object will do exactly what you want. It will destory the entire object, including all its derived class parts:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">TimeKeeper</span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="3 "></span>    <span class="n">TimeKeeper</span><span class="p">();</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">TimeKeeper</span><span class="p">();</span>
<span class="linenos" data-linenos="5 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="6 "></span><span class="p">};</span>
<span class="linenos" data-linenos="7 "></span><span class="n">TimeKeeper</span> <span class="o">*</span><span class="n">ptk</span> <span class="o">=</span> <span class="n">getTimeKeeper</span><span class="p">();</span>
<span class="linenos" data-linenos="8 "></span><span class="p">...</span>
<span class="linenos" data-linenos="9 "></span><span class="k">delete</span> <span class="n">ptk</span><span class="p">;</span>
</code></pre></div>
<p><strong>Things to Remember</strong></p>
<ul>
<li>Polymorphic base classes should declare virtual destructors. If a class has any virtual functions, it should have a virtual destructor.</li>
<li>Classes not designed to be base classes or not designed to be used polymorphically should not declare virtual destructors.</li>
</ul>
<h2 id="8-prevent-exceptions-from-leaving-destructors">8. Prevent exceptions from leaving destructors.</h2>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="o">~</span><span class="n">Widget</span><span class="p">(){...}</span>  <span class="c1">// assume this might emit an exception</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="kt">void</span> <span class="nf">doSomething</span><span class="p">()</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>   <span class="c1">// v is automatically destroyed here</span>
</code></pre></div>
<p>When the <code>vector v</code> is destroyed, suppose <code>v</code> has ten <code>Widget</code>s in it, and during destruction of the first one, an exception is thrown. The other nine <code>Widget</code>s still have to be destroyed, so <code>v</code> should invoke their destructors. But suppose that during those calls, a second <code>Widget</code> destructor throws an exception. Now there are two simultaneously active exceptions, and that's one too many for C++. Program execution either terminates or yields undefined behavior.</p>
<p>That's easy enough to understand, but what should you do if your destructor needs to perform an operation that may fail by throwing an exception? For example:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">DBConnection</span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">static</span> <span class="n">DBConnection</span> <span class="n">create</span><span class="p">();</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span>    <span class="kt">void</span> <span class="nf">close</span><span class="p">();</span> <span class="c1">// close connection; throw an exception if closing fails</span>
<span class="linenos" data-linenos="7 "></span><span class="p">};</span>
</code></pre></div>
<p>To ensure that clients don't forget to call <code>close</code> on <code>DBConnetion</code> objects, a reasonable idea would be create a resourse-managing class for <code>DBConnection</code> that calls <code>close</code> in its destructor.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">DBConn</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="o">~</span><span class="n">DBConn</span><span class="p">()</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="n">DBConnection</span> <span class="n">db</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">};</span>
</code></pre></div>
<p>That allows clients to program like this:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>    <span class="n">DBConn</span> <span class="nf">dbc</span><span class="p">(</span><span class="n">DBConnection</span><span class="o">::</span><span class="n">create</span><span class="p">());</span>
<span class="linenos" data-linenos="3 "></span>    <span class="p">...</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span> <span class="c1">// at the end of block, the DBConn object is destroyed, thus automatically calling close on the DBConnection object</span>
</code></pre></div>
<p>If destructor yields an exception, allow it to leave the destructor. That's a problem.</p>
<p>There are two primary ways to avoid the trouble:</p>
<ul>
<li>
<p><strong>Terminate the program</strong> if <code>close</code> throws, typically by calling <code>abort</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">DBConn</span><span class="o">::~</span><span class="n">DBConn</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">try</span><span class="p">{</span> <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span> <span class="p">}</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">catch</span><span class="p">(...){</span>
<span class="linenos" data-linenos="5 "></span>        <span class="c1">// make log entry that the call to close failed;</span>
<span class="linenos" data-linenos="6 "></span>        <span class="n">std</span><span class="o">::</span><span class="n">abort</span><span class="p">();</span>
<span class="linenos" data-linenos="7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Swallow the exception</strong> arising from the call to <code>close</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">DBConn</span><span class="o">::~</span><span class="n">DBConn</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">try</span><span class="p">{</span> <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span> <span class="p">}</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">catch</span><span class="p">(...){</span>
<span class="linenos" data-linenos="5 "></span>        <span class="c1">// make log entry that the call to close failed;</span>
<span class="linenos" data-linenos="6 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<p>In general, swallowing exception is a bad idea, because it suppresses important information. Sometimes, however, swallowing exception is preferable to running the risk of premature program termination or undefined behavior.</p>
</li>
</ul>
<p><strong>Things to Remember</strong></p>
<ul>
<li>Destructors should never emit exceptions. If functions called in a destructor may throw, the destructor should catch any exceptions, then swallow them or terminate the program.</li>
<li>If class clients need to be able to react to exceptions thrown during an operation, the class should provide a regular function that performs the operation.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" title="Back to top" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../exception/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Exception
            </div>
          </div>
        </a>
      
      
        <a href="../cpp11_feature/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              C++ 11 Feature
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1609d9a.min.js"></script>
      
    
  </body>
</html>